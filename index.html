<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hong Kong Salaries Tax Infographic (2025/26)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Sentry Error Monitoring -->
    <script
      src="https://js.sentry-cdn.com/cbfeb96a479d74e3f2e8331538a4e864.min.js"
      crossorigin="anonymous"
    ></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }
        .spinner {
            border-top-color: #0A9396;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-12">
            <div class="flex justify-end mb-4">
                <div class="relative">
                    <select id="languageSelector" class="bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#0A9396] focus:border-[#0A9396]">
                        <option value="en">English</option>
                        <option value="zh-Hant">ÁπÅÈ´î‰∏≠Êñá</option>
                    </select>
                </div>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold text-[#005F73] mb-2" data-i18n="title">Understanding Your Hong Kong Salaries Tax</h1>
            <p class="text-lg text-gray-600" data-i18n="subtitle">An Infographic for the 2025/26 Assessment Year</p>
        </header>

        <main class="space-y-8">
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div class="bg-white rounded-lg shadow-md p-6 flex flex-col justify-center items-center text-center">
                    <span class="text-5xl font-bold text-[#CA6702]">12.19%</span>
                    <p class="text-gray-700 mt-2" data-i18n="stat1_desc">Highest effective tax rate for incomes up to HK$70,000/month.</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 flex flex-col justify-center items-center text-center">
                     <span class="text-5xl font-bold text-[#0A9396]">HK$132,000</span>
                    <p class="text-gray-700 mt-2" data-i18n="stat2_desc">Standard Basic Allowance for the year.</p>
                </div>
                 <div class="bg-white rounded-lg shadow-md p-6 flex flex-col justify-center items-center text-center">
                    <span class="text-5xl font-bold text-[#94D2BD]">HK$4,800</span>
                    <p class="text-gray-700 mt-2" data-i18n="stat3_desc">Tax payable on a monthly income of HK$20,000.</p>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#005F73] mb-4" data-i18n="advisor_title">‚ú® Tax Savings Advisor</h2>
                <p class="text-gray-600 mb-6" data-i18n="advisor_desc">Curious about potential tax deductions? Select your income level and let our AI-powered advisor provide personalized tips based on the Hong Kong tax system. </p>
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="openModalBtn" class="bg-[#EE9B00] hover:bg-[#CA6702] text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 flex-1" data-i18n="advisor_button">
                        Get Personalized Tax Savings Tips
                    </button>
                    <button id="showIssuesBtn" class="bg-[#0A9396] hover:bg-[#005F73] text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 sm:flex-initial" data-i18n="show_issues_button">
                        üìä Show Recent Issues
                    </button>
                    <button id="testErrorBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 sm:flex-initial" data-i18n="test_error_button">
                        üêõ Test Error Monitoring
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#005F73] mb-4" data-i18n="chart1_title">Tax Payable by Income Level</h2>
                <p class="text-gray-600 mb-6" data-i18n="chart1_desc">This chart directly compares the total annual tax amount for different monthly incomes. It clearly shows how the absolute tax liability increases as income grows, with the most significant jumps occurring at higher income levels.</p>
                <div class="chart-container">
                    <canvas id="taxAmountChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#005F73] mb-4" data-i18n="chart2_title">The Rise of the Effective Tax Rate</h2>
                <p class="text-gray-600 mb-6" data-i18n="chart2_desc">While absolute tax increases, the effective tax rate‚Äîthe actual percentage of your total income paid in taxes‚Äîalso rises. This line chart illustrates Hong Kong's progressive tax system: the more you earn, the higher the percentage you contribute.</p>
                <div class="chart-container">
                    <canvas id="effectiveRateChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#005F73] mb-4" data-i18n="table_title">Detailed Tax Data Breakdown</h2>
                 <p class="text-gray-600 mb-6" data-i18n="table_desc">For those who want a closer look, this table provides the precise figures used in our visualizations, covering monthly income, annual income, total tax, and the resulting effective tax rate.</p>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr>
                                <th class="py-3 px-4 bg-[#0A9396] text-white font-bold uppercase text-sm rounded-tl-lg" data-i18n="table_monthly">Monthly Income (HKD)</th>
                                <th class="py-3 px-4 bg-[#0A9396] text-white font-bold uppercase text-sm" data-i18n="table_annual">Annual Income (HKD)</th>
                                <th class="py-3 px-4 bg-[#0A9396] text-white font-bold uppercase text-sm" data-i18n="table_tax">Tax (HKD)</th>
                                <th class="py-3 px-4 bg-[#0A9396] text-white font-bold uppercase text-sm rounded-tr-lg" data-i18n="table_rate">Effective Rate (%)</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-700">
                            <tr class="hover:bg-gray-100 border-b">
                                <td class="py-3 px-4">10,000</td>
                                <td class="py-3 px-4">120,000</td>
                                <td class="py-3 px-4">0</td>
                                <td class="py-3 px-4">0.00</td>
                            </tr>
                            <tr class="hover:bg-gray-100 border-b">
                                <td class="py-3 px-4">20,000</td>
                                <td class="py-3 px-4">240,000</td>
                                <td class="py-3 px-4">4,800</td>
                                <td class="py-3 px-4">2.00</td>
                            </tr>
                            <tr class="hover:bg-gray-100 border-b">
                                <td class="py-3 px-4">30,000</td>
                                <td class="py-3 px-4">360,000</td>
                                <td class="py-3 px-4">20,760</td>
                                <td class="py-3 px-4">5.77</td>
                            </tr>
                            <tr class="hover:bg-gray-100 border-b">
                                <td class="py-3 px-4">40,000</td>
                                <td class="py-3 px-4">480,000</td>
                                <td class="py-3 px-4">41,160</td>
                                <td class="py-3 px-4">8.58</td>
                            </tr>
                            <tr class="hover:bg-gray-100 border-b">
                                <td class="py-3 px-4">50,000</td>
                                <td class="py-3 px-4">600,000</td>
                                <td class="py-3 px-4">61,560</td>
                                <td class="py-3 px-4">10.26</td>
                            </tr>
                            <tr class="hover:bg-gray-100 border-b">
                                <td class="py-3 px-4">60,000</td>
                                <td class="py-3 px-4">720,000</td>
                                <td class="py-3 px-4">81,960</td>
                                <td class="py-3 px-4">11.38</td>
                            </tr>
                            <tr class="hover:bg-gray-100">
                                <td class="py-3 px-4">70,000</td>
                                <td class="py-3 px-4">840,000</td>
                                <td class="py-3 px-4">102,360</td>
                                <td class="py-3 px-4">12.19</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <footer class="text-center mt-12 py-6 border-t border-gray-300">
            <p class="text-gray-600 text-sm" data-i18n="footer_disclaimer">Data for 2025/26 assessment year. Assumes only the basic allowance of HK$132,000 and no other deductions. For informational purposes only.</p>
        </footer>

    </div>

    <div id="taxAdvisorModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl modal-content">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-2xl font-bold text-[#005F73]" data-i18n="modal_title">‚ú® AI Tax Savings Advisor</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div class="p-6">
                <div id="modal-initial-state">
                    <p class="text-gray-600 mb-4" data-i18n="modal_initial_text">Please select your monthly income level below. Our AI advisor will then generate potential tax-saving strategies for you.</p>
                    <div class="mb-4">
                        <label for="incomeSelect" class="block text-sm font-medium text-gray-700 mb-2" data-i18n="modal_income_label">Monthly Income (HKD):</label>
                        <select id="incomeSelect" class="w-full p-2 border border-gray-300 rounded-md focus:ring-[#0A9396] focus:border-[#0A9396]">
                        </select>
                    </div>
                    <button id="getTipsBtn" class="w-full bg-[#0A9396] hover:bg-[#005F73] text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300" data-i18n="modal_generate_button">
                        Generate My Tips
                    </button>
                </div>
                <div id="modal-loading-state" class="hidden text-center py-8">
                    <div class="spinner w-12 h-12 rounded-full border-4 border-gray-200 mx-auto mb-4"></div>
                    <p class="text-gray-600" data-i18n="modal_loading_text">Analyzing your situation and generating personalized tips...</p>
                </div>
                <div id="modal-results-state" class="hidden">
                    <h4 class="text-xl font-bold text-[#005F73] mb-4" data-i18n="modal_results_title">Your Personalized Tax Saving Tips:</h4>
                    <div id="tipsResult" class="prose max-w-none text-gray-700 bg-gray-50 p-4 rounded-lg"></div>
                     <p class="text-xs text-gray-500 mt-4" data-i18n="modal_disclaimer">Disclaimer: These tips are AI-generated for informational purposes only and do not constitute financial advice. Please consult with a qualified professional for financial guidance.</p>
                    <button id="resetModalBtn" class="mt-6 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300" data-i18n="modal_start_over">
                        Start Over
                    </button>
                </div>
                 <div id="modal-error-state" class="hidden text-center py-8">
                    <p class="text-red-600 font-bold" data-i18n="modal_error_title">An error occurred.</p>
                    <p class="text-gray-600" data-i18n="modal_error_text">Could not retrieve tips at this time. Please try again later.</p>
                     <button id="resetModalErrorBtn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300" data-i18n="modal_try_again">
                        Try Again
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sentry Issues Modal -->
    <div id="sentryIssuesModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl modal-content">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-2xl font-bold text-[#005F73]" data-i18n="issues_modal_title">üìä Recent Sentry Issues</h3>
                <button id="closeIssuesModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div class="p-6">
                <div id="issues-initial-state">
                    <p class="text-gray-600 mb-4" data-i18n="issues_initial_text">Click the button below to fetch your most recent Sentry issues. This will show errors, performance issues, and other monitoring data from your application.</p>
                    <button id="fetchIssuesBtn" class="w-full bg-[#0A9396] hover:bg-[#005F73] text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300" data-i18n="fetch_issues_button">
                        Fetch Recent Issues
                    </button>
                </div>
                <div id="issues-loading-state" class="hidden text-center py-8">
                    <div class="spinner w-12 h-12 rounded-full border-4 border-gray-200 mx-auto mb-4"></div>
                    <p class="text-gray-600" data-i18n="issues_loading_text">Fetching recent issues from Sentry...</p>
                </div>
                <div id="issues-results-state" class="hidden">
                    <h4 class="text-xl font-bold text-[#005F73] mb-4" data-i18n="issues_results_title">Recent Issues:</h4>
                    <div id="issuesResult" class="space-y-4 max-h-96 overflow-y-auto"></div>
                    <button id="refreshIssuesBtn" class="mt-6 w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300" data-i18n="refresh_issues_button">
                        Refresh Issues
                    </button>
                </div>
                <div id="issues-error-state" class="hidden text-center py-8">
                    <p class="text-red-600 font-bold" data-i18n="issues_error_title">Failed to fetch issues</p>
                    <p class="text-gray-600" data-i18n="issues_error_text">Could not retrieve issues from Sentry. Please check your API token and try again.</p>
                    <button id="retryIssuesBtn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300" data-i18n="retry_issues_button">
                        Try Again
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sentry Error Monitoring Configuration
        // To customize Sentry monitoring:
        // 1. Update the environment value to match your deployment (development/production)
        // 2. Update the release version to match your app version
        try {
            if (typeof Sentry !== 'undefined') {
                Sentry.init({
                    environment: 'development', // Change to 'production' for live deployments
                    release: 'tax-rate-app@1.0.0', // Update with your app version
                    integrations: [
                        new Sentry.Integrations.BrowserTracing(),
                    ],
                    // Performance Monitoring
                    tracesSampleRate: 1.0, // Capture 100% of the transactions, reduce in production
                    // Session Replay (optional)
                    replaysSessionSampleRate: 0.1, // 10% of sessions will be recorded
                    replaysOnErrorSampleRate: 1.0, // 100% of sessions with errors will be recorded
                    beforeSend: (event) => {
                        // Filter out non-error events in development
                        if (event.exception && event.exception.values) {
                            console.log('Sentry capturing error:', event);
                        }
                        return event;
                    }
                });

                // Set user context
                Sentry.setUser({
                    id: 'anonymous',
                });

                // Set tags
                Sentry.setTag('app', 'tax-rate-app');
                Sentry.setTag('feature', 'tax-calculator');

                console.log('Sentry error monitoring initialized successfully');
            } else {
                console.warn('Sentry SDK not loaded - error monitoring disabled');
            }
        } catch (error) {
            console.error('Failed to initialize Sentry:', error);
        }

        // Translation object
        const translations = {
            en: {
                title: "Understanding Your Hong Kong Salaries Tax",
                subtitle: "An Infographic for the 2025/26 Assessment Year",
                stat1_desc: "Highest effective tax rate for incomes up to HK$70,000/month.",
                stat2_desc: "Standard Basic Allowance for the year.",
                stat3_desc: "Tax payable on a monthly income of HK$20,000.",
                advisor_title: "‚ú® Tax Savings Advisor",
                advisor_desc: "Curious about potential tax deductions? Select your income level and let our AI-powered advisor provide personalized tips based on the Hong Kong tax system.",
                advisor_button: "Get Personalized Tax Savings Tips",
                chart1_title: "Tax Payable by Income Level",
                chart1_desc: "This chart directly compares the total annual tax amount for different monthly incomes. It clearly shows how the absolute tax liability increases as income grows, with the most significant jumps occurring at higher income levels.",
                chart2_title: "The Rise of the Effective Tax Rate",
                chart2_desc: "While absolute tax increases, the effective tax rate‚Äîthe actual percentage of your total income paid in taxes‚Äîalso rises. This line chart illustrates Hong Kong's progressive tax system: the more you earn, the higher the percentage you contribute.",
                table_title: "Detailed Tax Data Breakdown",
                table_desc: "For those who want a closer look, this table provides the precise figures used in our visualizations, covering monthly income, annual income, total tax, and the resulting effective tax rate.",
                table_monthly: "Monthly Income (HKD)",
                table_annual: "Annual Income (HKD)",
                table_tax: "Tax (HKD)",
                table_rate: "Effective Rate (%)",
                footer_disclaimer: "Data for 2025/26 assessment year. Assumes only the basic allowance of HK$132,000 and no other deductions. For informational purposes only.",
                modal_title: "‚ú® AI Tax Savings Advisor",
                modal_initial_text: "Please select your monthly income level below. Our AI advisor will then generate potential tax-saving strategies for you.",
                modal_income_label: "Monthly Income (HKD):",
                modal_generate_button: "Generate My Tips",
                modal_loading_text: "Analyzing your situation and generating personalized tips...",
                modal_results_title: "Your Personalized Tax Saving Tips:",
                modal_disclaimer: "Disclaimer: These tips are AI-generated for informational purposes only and do not constitute financial advice. Please consult with a qualified professional for financial guidance.",
                modal_start_over: "Start Over",
                modal_error_title: "An error occurred.",
                modal_error_text: "Could not retrieve tips at this time. Please try again later.",
                modal_try_again: "Try Again",
                chart_tax_label: "Tax (HKD)",
                chart_rate_label: "Effective Rate (%)",
                test_error_button: "üêõ Test Error Monitoring",
                show_issues_button: "üìä Show Recent Issues",
                issues_modal_title: "üìä Recent Sentry Issues",
                issues_initial_text: "Click the button below to fetch your most recent Sentry issues. This will show errors, performance issues, and other monitoring data from your application.",
                fetch_issues_button: "Fetch Recent Issues",
                issues_loading_text: "Fetching recent issues from Sentry...",
                issues_results_title: "Recent Issues:",
                refresh_issues_button: "Refresh Issues",
                issues_error_title: "Failed to fetch issues",
                issues_error_text: "Could not retrieve issues from Sentry. Please check your API token and try again.",
                retry_issues_button: "Try Again"
            },
            "zh-Hant": {
                title: "‰∫ÜËß£ÊÇ®ÁöÑÈ¶ôÊ∏ØËñ™‰ø∏Á®Ö",
                subtitle: "2025/26 Ë™≤Á®ÖÂπ¥Â∫¶Ë≥áË®äÂúñË°®",
                stat1_desc: "ÊúàÂÖ•È´òÈÅîÊ∏ØÂπ£70,000ÂÖÉÁöÑÊúÄÈ´òÊúâÊïàÁ®ÖÁéá„ÄÇ",
                stat2_desc: "ÂÖ®Âπ¥Ê®ôÊ∫ñÂü∫Êú¨ÂÖçÁ®ÖÈ°ç„ÄÇ",
                stat3_desc: "ÊúàËñ™Ê∏ØÂπ£20,000ÂÖÉÊáâÁπ≥Á®ÖÊ¨æ„ÄÇ",
                advisor_title: "‚ú® Á®ÖÂãôÁØÄÁúÅÈ°ßÂïè",
                advisor_desc: "Â•ΩÂ•áÊΩõÂú®ÁöÑÁ®ÖÂãôÊâ£Ê∏õÂóéÔºüÈÅ∏ÊìáÊÇ®ÁöÑÊî∂ÂÖ•Ê∞¥Âπ≥ÔºåËÆìÊàëÂÄëÁöÑAIÊô∫ËÉΩÈ°ßÂïèÊ†πÊìöÈ¶ôÊ∏ØÁ®ÖÂà∂ÁÇ∫ÊÇ®Êèê‰æõÂÄã‰∫∫ÂåñÂª∫Ë≠∞„ÄÇ",
                advisor_button: "Áç≤ÂèñÂÄã‰∫∫ÂåñÁ®ÖÂãôÁØÄÁúÅÂª∫Ë≠∞",
                chart1_title: "ÊåâÊî∂ÂÖ•Ê∞¥Âπ≥ÂäÉÂàÜÁöÑÊáâÁπ≥Á®ÖÊ¨æ",
                chart1_desc: "Ê≠§ÂúñË°®Áõ¥Êé•ÊØîËºÉ‰∏çÂêåÊúàÊî∂ÂÖ•ÁöÑÂÖ®Âπ¥Á®ÖÊ¨æÁ∏ΩÈ°ç„ÄÇÂÆÉÊ∏ÖÊ•öÈ°ØÁ§∫ÁµïÂ∞çÁ®ÖÂãôË≤†ÊìîÂ¶Ç‰ΩïÈö®ËëóÊî∂ÂÖ•Â¢ûÈï∑ËÄåÂ¢ûÂä†ÔºåÂú®ËºÉÈ´òÊî∂ÂÖ•Ê∞¥Âπ≥ÊôÇÂ¢ûÂπÖÊúÄÁÇ∫È°ØËëó„ÄÇ",
                chart2_title: "ÊúâÊïàÁ®ÖÁéáÁöÑ‰∏äÂçá",
                chart2_desc: "ÈõñÁÑ∂ÁµïÂ∞çÁ®ÖÈ°çÂ¢ûÂä†ÔºåÊúâÊïàÁ®ÖÁéá‚Äî‚ÄîÊÇ®Á∏ΩÊî∂ÂÖ•‰∏≠ÂØ¶ÈöõÁπ≥Á¥çÁ®ÖÊ¨æÁöÑÁôæÂàÜÊØî‚Äî‚Äî‰πüÂú®‰∏äÂçá„ÄÇÊ≠§Á∑öÂúñË™™Êòé‰∫ÜÈ¶ôÊ∏ØÁöÑÁ¥ØÈÄ≤Á®ÖÂà∂ÔºöÊÇ®Ë≥∫ÂæóË∂äÂ§öÔºåË≤¢ÁçªÁöÑÁôæÂàÜÊØîÂ∞±Ë∂äÈ´ò„ÄÇ",
                table_title: "Ë©≥Á¥∞Á®ÖÂãôÊï∏ÊìöÂàÜÊûê",
                table_desc: "Â∞çÊñºÂ∏åÊúõÊõ¥Ê∑±ÂÖ•‰∫ÜËß£ÁöÑ‰∫∫Â£´ÔºåÊ≠§Ë°®Ê†ºÊèê‰æõ‰∫ÜÊàëÂÄëË¶ñË¶∫ÂåñÂúñË°®‰∏≠‰ΩøÁî®ÁöÑÁ≤æÁ¢∫Êï∏Â≠óÔºåÊ∂µËìãÊúàÊî∂ÂÖ•„ÄÅÂπ¥Êî∂ÂÖ•„ÄÅÁ∏ΩÁ®ÖÊ¨æÂíåÁõ∏ÊáâÁöÑÊúâÊïàÁ®ÖÁéá„ÄÇ",
                table_monthly: "ÊúàÊî∂ÂÖ•ÔºàÊ∏ØÂπ£Ôºâ",
                table_annual: "Âπ¥Êî∂ÂÖ•ÔºàÊ∏ØÂπ£Ôºâ",
                table_tax: "Á®ÖÊ¨æÔºàÊ∏ØÂπ£Ôºâ",
                table_rate: "ÊúâÊïàÁ®ÖÁéáÔºà%Ôºâ",
                footer_disclaimer: "2025/26Ë™≤Á®ÖÂπ¥Â∫¶Êï∏Êìö„ÄÇÂÉÖÂÅáË®≠Ê∏ØÂπ£132,000ÂÖÉÂü∫Êú¨ÂÖçÁ®ÖÈ°çÔºå‰∏çÂåÖÊã¨ÂÖ∂‰ªñÊâ£Ê∏õ„ÄÇÂÉÖ‰æõÂèÉËÄÉÁî®ÈÄî„ÄÇ",
                modal_title: "‚ú® AIÁ®ÖÂãôÁØÄÁúÅÈ°ßÂïè",
                modal_initial_text: "Ë´ãÂú®‰∏ãÊñπÈÅ∏ÊìáÊÇ®ÁöÑÊúàÊî∂ÂÖ•Ê∞¥Âπ≥„ÄÇÊàëÂÄëÁöÑAIÈ°ßÂïèÂ∞áÁÇ∫ÊÇ®ÁîüÊàêÊΩõÂú®ÁöÑÁ®ÖÂãôÁØÄÁúÅÁ≠ñÁï•„ÄÇ",
                modal_income_label: "ÊúàÊî∂ÂÖ•ÔºàÊ∏ØÂπ£ÔºâÔºö",
                modal_generate_button: "ÁîüÊàêÊàëÁöÑÂª∫Ë≠∞",
                modal_loading_text: "Ê≠£Âú®ÂàÜÊûêÊÇ®ÁöÑÊÉÖÊ≥Å‰∏¶ÁîüÊàêÂÄã‰∫∫ÂåñÂª∫Ë≠∞...",
                modal_results_title: "ÊÇ®ÁöÑÂÄã‰∫∫ÂåñÁ®ÖÂãôÁØÄÁúÅÂª∫Ë≠∞Ôºö",
                modal_disclaimer: "ÂÖçË≤¨ËÅ≤ÊòéÔºöÈÄô‰∫õÂª∫Ë≠∞Áî±AIÁîüÊàêÔºåÂÉÖ‰æõÂèÉËÄÉÔºå‰∏çÊßãÊàêË≤°ÂãôÂª∫Ë≠∞„ÄÇË´ãÂêëÂêàË≥áÊ†ºÂ∞àÊ•≠‰∫∫Â£´Ë´ÆË©¢Ë≤°ÂãôÊåáÂ∞é„ÄÇ",
                modal_start_over: "ÈáçÊñ∞ÈñãÂßã",
                modal_error_title: "ÁôºÁîüÈåØË™§„ÄÇ",
                modal_error_text: "ÁõÆÂâçÁÑ°Ê≥ïÁç≤ÂèñÂª∫Ë≠∞„ÄÇË´ãÁ®çÂæåÂÜçË©¶„ÄÇ",
                modal_try_again: "ÈáçË©¶",
                chart_tax_label: "Á®ÖÊ¨æÔºàÊ∏ØÂπ£Ôºâ",
                chart_rate_label: "ÊúâÊïàÁ®ÖÁéáÔºà%Ôºâ",
                test_error_button: "üêõ Ê∏¨Ë©¶ÈåØË™§Áõ£Êéß",
                show_issues_button: "üìä È°ØÁ§∫ËøëÊúüÂïèÈ°å",
                issues_modal_title: "üìä ËøëÊúü Sentry ÂïèÈ°å",
                issues_initial_text: "ÈªûÊìä‰∏ãÊñπÊåâÈàïÁç≤ÂèñÊÇ®ÊúÄËøëÁöÑ Sentry ÂïèÈ°å„ÄÇÈÄôÂ∞áÈ°ØÁ§∫‰æÜËá™ÊÇ®ÊáâÁî®Á®ãÂºèÁöÑÈåØË™§„ÄÅÊÄßËÉΩÂïèÈ°åÂíåÂÖ∂‰ªñÁõ£ÊéßÊï∏Êìö„ÄÇ",
                fetch_issues_button: "Áç≤ÂèñËøëÊúüÂïèÈ°å",
                issues_loading_text: "Ê≠£Âú®Âæû Sentry Áç≤ÂèñËøëÊúüÂïèÈ°å...",
                issues_results_title: "ËøëÊúüÂïèÈ°åÔºö",
                refresh_issues_button: "Âà∑Êñ∞ÂïèÈ°å",
                issues_error_title: "Áç≤ÂèñÂïèÈ°åÂ§±Êïó",
                issues_error_text: "ÁÑ°Ê≥ïÂæû Sentry Ê™¢Á¥¢ÂïèÈ°å„ÄÇË´ãÊ™¢Êü•ÊÇ®ÁöÑ API ‰ª§Áâå‰∏¶ÈáçË©¶„ÄÇ",
                retry_issues_button: "ÈáçË©¶"
            }
        };

        // Current language
        let currentLanguage = localStorage.getItem('preferredLanguage') || 'en';

        // Localization function
        function updateContent(language) {
            currentLanguage = language;
            localStorage.setItem('preferredLanguage', language);
            
            // Update HTML lang attribute
            document.documentElement.lang = language === 'zh-Hant' ? 'zh-HK' : 'en';
            
            // Update all elements with data-i18n attributes
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[language] && translations[language][key]) {
                    element.textContent = translations[language][key];
                }
            });
            
            // Update charts
            updateCharts();
        }

        // Initialize language selector
        function initializeLanguageSelector() {
            const languageSelector = document.getElementById('languageSelector');
            languageSelector.value = currentLanguage;
            
            languageSelector.addEventListener('change', (e) => {
                updateContent(e.target.value);
            });
        }

        const taxData = {
            monthlyIncome: [10000, 20000, 30000, 40000, 50000, 60000, 70000],
            annualIncome: [120000, 240000, 360000, 480000, 600000, 720000, 840000],
            taxPayable: [0, 4800, 20760, 41160, 61560, 81960, 102360],
            effectiveRate: [0.00, 2.00, 5.77, 8.58, 10.26, 11.38, 12.19]
        };

        let taxAmountChart, effectiveRateChart;

        function getChartLabels() {
            return taxData.monthlyIncome.map(income => `HK$${income.toLocaleString()}`);
        }
        
        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            }
            return label;
        };

        const commonChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        title: tooltipTitleCallback
                    },
                    backgroundColor: '#005F73',
                    titleFont: {
                        size: 14,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 12
                    },
                    padding: 10,
                    cornerRadius: 4,
                    displayColors: false
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#4B5563'
                    }
                },
                y: {
                    grid: {
                        color: '#E5E7EB'
                    },
                    ticks: {
                        color: '#4B5563',
                        beginAtZero: true
                    }
                }
            }
        };

        function createCharts() {
            try {
                const ctxBar = document.getElementById('taxAmountChart').getContext('2d');
                taxAmountChart = new Chart(ctxBar, {
                    type: 'bar',
                    data: {
                        labels: getChartLabels(),
                        datasets: [{
                            label: translations[currentLanguage].chart_tax_label,
                            data: taxData.taxPayable,
                            backgroundColor: '#0A9396',
                            borderColor: '#005F73',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        ...commonChartOptions,
                        scales: {
                            ...commonChartOptions.scales,
                            y: {
                                ...commonChartOptions.scales.y,
                                ticks: {
                                     ...commonChartOptions.scales.y.ticks,
                                    callback: function(value) {
                                        return 'HK$' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error creating tax amount chart:', error);
                if (typeof Sentry !== 'undefined' && Sentry.captureException) {
                    Sentry.captureException(error);
                }
            }

            try {
                const ctxLine = document.getElementById('effectiveRateChart').getContext('2d');
                effectiveRateChart = new Chart(ctxLine, {
                    type: 'line',
                    data: {
                        labels: getChartLabels(),
                        datasets: [{
                            label: translations[currentLanguage].chart_rate_label,
                            data: taxData.effectiveRate,
                            backgroundColor: 'rgba(238, 155, 0, 0.2)',
                            borderColor: '#EE9B00',
                            pointBackgroundColor: '#CA6702',
                            pointBorderColor: '#fff',
                            pointHoverRadius: 7,
                            pointHoverBackgroundColor: '#CA6702',
                            pointRadius: 5,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        ...commonChartOptions,
                         scales: {
                            ...commonChartOptions.scales,
                            y: {
                                ...commonChartOptions.scales.y,
                                ticks: {
                                     ...commonChartOptions.scales.y.ticks,
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error creating effective rate chart:', error);
                if (typeof Sentry !== 'undefined' && Sentry.captureException) {
                    Sentry.captureException(error);
                }
            }
        }

        function updateCharts() {
            if (taxAmountChart) {
                taxAmountChart.data.datasets[0].label = translations[currentLanguage].chart_tax_label;
                taxAmountChart.update();
            }
            
            if (effectiveRateChart) {
                effectiveRateChart.data.datasets[0].label = translations[currentLanguage].chart_rate_label;
                effectiveRateChart.update();
            }
        }

        const modal = document.getElementById('taxAdvisorModal');
        const openModalBtn = document.getElementById('openModalBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const getTipsBtn = document.getElementById('getTipsBtn');
        const incomeSelect = document.getElementById('incomeSelect');
        const resetModalBtn = document.getElementById('resetModalBtn');
        const resetModalErrorBtn = document.getElementById('resetModalErrorBtn');
        const testErrorBtn = document.getElementById('testErrorBtn');

        // Sentry Issues Modal elements
        const issuesModal = document.getElementById('sentryIssuesModal');
        const showIssuesBtn = document.getElementById('showIssuesBtn');
        const closeIssuesModalBtn = document.getElementById('closeIssuesModalBtn');
        const fetchIssuesBtn = document.getElementById('fetchIssuesBtn');
        const refreshIssuesBtn = document.getElementById('refreshIssuesBtn');
        const retryIssuesBtn = document.getElementById('retryIssuesBtn');

        const issuesInitialState = document.getElementById('issues-initial-state');
        const issuesLoadingState = document.getElementById('issues-loading-state');
        const issuesResultsState = document.getElementById('issues-results-state');
        const issuesErrorState = document.getElementById('issues-error-state');
        const issuesResult = document.getElementById('issuesResult');

        const initialState = document.getElementById('modal-initial-state');
        const loadingState = document.getElementById('modal-loading-state');
        const resultsState = document.getElementById('modal-results-state');
        const errorState = document.getElementById('modal-error-state');
        const tipsResult = document.getElementById('tipsResult');

        function populateIncomeSelect() {
            incomeSelect.innerHTML = '';
            taxData.monthlyIncome.forEach(income => {
                const option = document.createElement('option');
                option.value = income;
                option.textContent = `HK$${income.toLocaleString()}`;
                incomeSelect.appendChild(option);
            });
        }

        // Sentry Issues Functions
        async function fetchSentryIssues() {
            // Extract organization and project from the DSN
            // DSN format: https://PUBLIC_KEY@o<ORGANIZATION_ID>.ingest.sentry.io/<PROJECT_ID>
            const sentryDSN = 'cbfeb96a479d74e3f2e8331538a4e864';
            
            // For demo purposes, we'll use publicly available information
            // In a real application, you would need:
            // 1. A Sentry API token
            // 2. Organization slug
            // 3. Project slug
            
            const API_TOKEN = ''; // Users would need to provide their own API token
            const ORG_SLUG = 'your-organization'; // Users would need to provide their org
            const PROJECT_SLUG = 'your-project'; // Users would need to provide their project
            
            if (!API_TOKEN) {
                throw new Error('API token not configured. Please set up your Sentry API token.');
            }
            
            const response = await fetch(`https://sentry.io/api/0/projects/${ORG_SLUG}/${PROJECT_SLUG}/issues/`, {
                headers: {
                    'Authorization': `Bearer ${API_TOKEN}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`Failed to fetch issues: ${response.status} ${response.statusText}`);
            }
            
            return await response.json();
        }

        function createMockSentryIssues() {
            // Since we don't have real API credentials, create mock data for demonstration
            return [
                {
                    id: '12345',
                    title: 'TypeError: Cannot read property of undefined',
                    culprit: 'createCharts() in index.html',
                    level: 'error',
                    status: 'unresolved',
                    count: '15',
                    firstSeen: '2024-01-15T10:30:00Z',
                    lastSeen: '2024-01-15T15:45:00Z',
                    permalink: 'https://sentry.io/organizations/your-org/issues/12345/',
                    metadata: {
                        type: 'TypeError',
                        value: 'Cannot read property \'getContext\' of null'
                    }
                },
                {
                    id: '12346',
                    title: 'API request failed with status 401',
                    culprit: 'getTipsBtn click handler in index.html',
                    level: 'error',
                    status: 'unresolved',
                    count: '3',
                    firstSeen: '2024-01-15T14:20:00Z',
                    lastSeen: '2024-01-15T14:22:00Z',
                    permalink: 'https://sentry.io/organizations/your-org/issues/12346/',
                    metadata: {
                        type: 'Error',
                        value: 'API request failed with status 401'
                    }
                },
                {
                    id: '12347',
                    title: 'This is a test error for Sentry monitoring demonstration',
                    culprit: 'testErrorBtn click handler in index.html',
                    level: 'error',
                    status: 'unresolved',
                    count: '8',
                    firstSeen: '2024-01-15T09:15:00Z',
                    lastSeen: '2024-01-15T16:30:00Z',
                    permalink: 'https://sentry.io/organizations/your-org/issues/12347/',
                    metadata: {
                        type: 'TestError',
                        value: 'This is a test error for Sentry monitoring demonstration'
                    }
                }
            ];
        }

        function renderIssues(issues) {
            issuesResult.innerHTML = '';
            
            if (!issues || issues.length === 0) {
                issuesResult.innerHTML = '<p class="text-gray-500 text-center py-4">No issues found.</p>';
                return;
            }
            
            issues.forEach(issue => {
                const issueCard = document.createElement('div');
                issueCard.className = 'bg-gray-50 rounded-lg p-4 border border-gray-200';
                
                const levelColor = issue.level === 'error' ? 'text-red-600' : 
                                 issue.level === 'warning' ? 'text-yellow-600' : 'text-blue-600';
                
                const timeAgo = new Date(issue.lastSeen).toLocaleString();
                
                issueCard.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h5 class="font-semibold text-gray-900 flex-1">${issue.title}</h5>
                        <span class="px-2 py-1 text-xs rounded-full bg-gray-200 text-gray-700 ml-2">${issue.count} events</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${issue.culprit}</p>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span class="${levelColor} font-medium uppercase">${issue.level}</span>
                        <span>Last seen: ${timeAgo}</span>
                    </div>
                    <div class="mt-2">
                        <a href="${issue.permalink}" target="_blank" class="text-[#0A9396] hover:text-[#005F73] text-sm font-medium">
                            View in Sentry ‚Üí
                        </a>
                    </div>
                `;
                
                issuesResult.appendChild(issueCard);
            });
        }

        function showIssuesModal() {
            issuesModal.classList.remove('hidden');
            issuesModal.classList.add('flex');
        }

        function hideIssuesModal() {
            issuesModal.classList.add('hidden');
            issuesModal.classList.remove('flex');
            resetIssuesModal();
        }

        function resetIssuesModal() {
            issuesInitialState.classList.remove('hidden');
            issuesLoadingState.classList.add('hidden');
            issuesResultsState.classList.add('hidden');
            issuesErrorState.classList.add('hidden');
            issuesResult.innerHTML = '';
        }

        const showModal = () => {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        };

        const hideModal = () => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            resetModal();
        };

        const resetModal = () => {
            initialState.classList.remove('hidden');
            loadingState.classList.add('hidden');
            resultsState.classList.add('hidden');
            errorState.classList.add('hidden');
            tipsResult.innerHTML = '';
            incomeSelect.selectedIndex = 0;
        };

        openModalBtn.addEventListener('click', showModal);
        closeModalBtn.addEventListener('click', hideModal);
        resetModalBtn.addEventListener('click', resetModal);
        resetModalErrorBtn.addEventListener('click', resetModal);
        
        // Sentry Issues Modal Event Listeners
        showIssuesBtn.addEventListener('click', showIssuesModal);
        closeIssuesModalBtn.addEventListener('click', hideIssuesModal);
        refreshIssuesBtn.addEventListener('click', () => {
            resetIssuesModal();
        });
        retryIssuesBtn.addEventListener('click', () => {
            resetIssuesModal();
        });
        
        // Fetch Issues Handler
        async function handleFetchIssues() {
            issuesInitialState.classList.add('hidden');
            issuesLoadingState.classList.remove('hidden');
            
            try {
                let issues;
                try {
                    issues = await fetchSentryIssues();
                } catch (apiError) {
                    console.log('API call failed, using mock data for demonstration:', apiError.message);
                    // Use mock data when API is not available
                    issues = createMockSentryIssues();
                }
                
                renderIssues(issues);
                issuesLoadingState.classList.add('hidden');
                issuesResultsState.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error fetching Sentry issues:', error);
                
                if (typeof Sentry !== 'undefined' && Sentry.captureException) {
                    Sentry.addBreadcrumb({
                        message: 'Failed to fetch Sentry issues',
                        category: 'api',
                        level: 'error',
                        data: {
                            errorMessage: error.message
                        }
                    });
                    Sentry.captureException(error);
                }
                
                issuesLoadingState.classList.add('hidden');
                issuesErrorState.classList.remove('hidden');
            }
        }
        
        fetchIssuesBtn.addEventListener('click', handleFetchIssues);
        
        // Modal click outside to close
        issuesModal.addEventListener('click', (e) => {
            if (e.target === issuesModal) {
                hideIssuesModal();
            }
        });
        
        // Test error button for Sentry demonstration
        testErrorBtn.addEventListener('click', () => {
            try {
                // Create a test error for Sentry monitoring demonstration
                const testError = new Error('This is a test error for Sentry monitoring demonstration');
                testError.name = 'TestError';
                
                // Add additional context
                if (typeof Sentry !== 'undefined' && Sentry.addBreadcrumb) {
                    Sentry.addBreadcrumb({
                        message: 'User clicked test error button',
                        category: 'user-action',
                        level: 'info'
                    });
                }
                
                // Capture with Sentry if available
                if (typeof Sentry !== 'undefined' && Sentry.captureException) {
                    Sentry.captureException(testError);
                    alert('Test error has been sent to Sentry monitoring! Check your Sentry dashboard to see the error report.');
                } else {
                    alert('Sentry is not properly configured. Please check the console for more information.');
                }
                
                // Also throw the error to trigger any global error handlers
                throw testError;
            } catch (error) {
                console.error('Test error triggered:', error);
            }
        });
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                hideModal();
            }
        });

        getTipsBtn.addEventListener('click', async () => {
            const selectedIncome = incomeSelect.value;
            
            initialState.classList.add('hidden');
            loadingState.classList.remove('hidden');

            const prompt = `I am a single person in Hong Kong with a monthly income of ${selectedIncome} HKD and only the basic allowance. Based on the Hong Kong tax system, provide three actionable and personalized tax-saving tips. For example, suggest things like making voluntary contributions to an MPF scheme, approved charitable donations, or self-education expenses. Keep the tips concise, easy to understand for a non-accountant, and format them as an unordered list using Markdown.`;

            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    let text = result.candidates[0].content.parts[0].text;
                    text = text.replace(/\*/g, '‚Ä¢');
                    tipsResult.innerHTML = text.split('\n').map(line => `<p>${line}</p>`).join('');

                    loadingState.classList.add('hidden');
                    resultsState.classList.remove('hidden');
                } else {
                    throw new Error("Invalid response structure from API.");
                }

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                
                // Capture API errors with Sentry
                if (typeof Sentry !== 'undefined' && Sentry.captureException) {
                    Sentry.addBreadcrumb({
                        message: 'API call failed',
                        category: 'api',
                        level: 'error',
                        data: {
                            selectedIncome: selectedIncome,
                            errorMessage: error.message
                        }
                    });
                    Sentry.captureException(error);
                }
                
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
            }
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initializeLanguageSelector();
            populateIncomeSelect();
            updateContent(currentLanguage);
            
            // Try to create charts, but don't let errors prevent localization
            try {
                createCharts();
            } catch (error) {
                console.warn('Chart creation failed:', error);
            }
        });

    </script>
</body>
</html>
